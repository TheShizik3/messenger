# Проект: Разработка Desktop мессенджера на C++

## Выполнили: Горожанкин Андрей, Надолинский Даниил
## Научный руководитель: Павлов Михаил Александрович
### Используемые технологии: C++, Qt, Boost.Asio, CMake
#### Содержание

##### Введение 
######    1.1. Название темы 
######    1.2. Проблема 
######    1.3. Актуальность 
######    1.4. Область исследования 
######    1.5. Цель
######    1.6. Гипотеза 
######    1.7. Задачи 
######    1.8. Методы работы 

##### Основная часть 
######    2.1. Анализ существующих решений и выбор технологий 
######    2.2. Проектирование архитектуры мессенджера 
######   2.3. Реализация серверной части с использованием Boost.Asio 
######   2.4. Организация сетевого взаимодействия и протокола обмена 
######   2.5. Сборка проекта с помощью CMake и тестирование

#####    Заключение

#####    Список использованных источников и ресурсов 

#### 1. Введение
##### 1.1. Название темы

Разработка Desktop мессенджера на C++ для обмена текстовыми сообщениями в сети с использованием современных библиотек C++.
##### 1.2. Проблема

В школьной среде, на кружках, в компьютерных классах или дома с друзьями часто возникает необходимость быстрого обмена сообщениями без использования интернета и сторонних сервисов (WhatsApp, Telegram, VK), которые могут быть недоступны или запрещены. 
##### 1.3. Актуальность

Современный пользователь всё больше ценит защищённые каналы связи, интуитивный интерфейс, быстрый отклик от приложения, дополнительные функции и интеграции, а
многие популярные мессенджеры имеют ограничения по функционалу и интерфейсу, что создаёт возможность для инноваций.

##### 1.4. Область исследования
    Информатика и программирование: написание кода на C++.
    Сетевые технологии: понимание модели TCP/IP, сокетов, клиент-серверной архитектуры.
    Разработка пользовательских интерфейсов: создание интуитивно понятного GUI с помощью фреймворка Qt.

##### 1.5. Цель
Освоить разработку Desktop приложений и взаимодействие с веб-сокетами на C++, Разработать и реализовать работоспособный простейший мессенджер, состоящий из сервера и клиента.

##### 1.6. Гипотеза

Используя современные, хорошо документированные библиотеки C++ (Qt для интерфейса и Boost.Asio для сети), даже начинающий программист (ученик 7 класса) может создать стабильное сетевое приложение с графическим интерфейсом, понимая при этом основные принципы взаимодействия клиента с сервером.
##### 1.7. Задачи
- Собрать информацию о уже существующих мессенджерах
- Ознакомиться с документацией библиотек Qt и Boost.Asio.
- Реализовать клиентское приложение с графическим интерфейсом 
- Спроектировать простой текстовый протокол для обмена сообщениями между клиентом и сервером.
- Скомпилировать приложение на Linux    
- Провести тестирование приложения в локальной сети (на одном и нескольких компьютерах).

##### 1.8. Методы работы

    Теоретический анализ: документации Qt и Boost, статей по сетевому программированию на C++.

    Проектирование: Проектирование алгоритма работы сервера и клиента.

    Экспериментальный метод: написание кода, его компиляция, запуск и отладка.

    Тестирование: проверка работы программы в различных условиях (корректные/некорректные данные, отключение клиента, запуск нескольких клиентов).

#### 2. Основная часть
##### 2.1. Анализ существующих решений и выбор технологий

Перед началом разработки были рассмотрены возможные инструменты.

    Язык программирования C++: выбран из-за его производительности, широких возможностей и желания углубить знания в этом языке.

    Фреймворк Qt: предоставляет мощные средства для создания кроссплатформенного графического интерфейса (работает на Windows, Linux, macOS). Также Qt имеет собственные модули для работы с сетью (QTcpSocket, QTcpServer), но для образовательных целей был выбран более низкоуровневый вариант.

    Библиотека Boost.Asio: является отраслевым стандартом для асинхронного сетевого программирования на C++. Позволяет работать с сокетами напрямую, что дает более глубокое понимание происходящего "под капотом" по сравнению с высокоуровневыми абстракциями Qt.

    Система сборки CMake: стандарт для C++ проектов, позволяет легко собирать проект под разные операционные системы и компиляторы, управлять зависимостями (Qt, Boost).

Итоговый стек: C++20, Qt 6.4 (только для GUI клиента), Boost.Asio (для сетевого кода сервера и клиента), CMake.
##### 2.2. Проектирование архитектуры мессенджера

Приложение состоит из двух программ:

    Сервер (server):

        Не имеет графического интерфейса (консольное приложение).

        Запускается на одном из компьютеров в сети.

        Прослушивает определенный порт.

        Принимает входящие подключения от клиентов.

        Получив сообщение от клиента, сохраняет его в очередь сообщений получателя.

    Клиент (client):

        Имеет графический интерфейс, созданный на Qt.
        
        Отображает основное окно чата.

        Окно чата содержит:

            Область для отображения истории сообщений (ScrollView).

            Поле для ввода нового сообщения (TextArea).

            Кнопку отправки.

            Список контактов.

###### Принцип работы:

    Пользователь запускает сервер на машине с известным статичным IP-адресом.

    Пользователи запускают клиент.

    Клиент устанавливает TCP-соединение с сервером.

    Сервер регистрирует нового клиента.

    Пользователь печатает сообщение в клиенте и отправляет его.

    Клиент конвертирует текст в json и отправляет его по сети серверу.

    Сервер принимает сообщение и отправляет его в FIFO очередь получателя.

##### 2.3. Реализация серверной части с использованием Boost.Asio

Сервер реализован как асинхронное приложение. Это позволяет обрабатывать множество клиентов без создания отдельного потока для каждого, что эффективно с точки зрения ресурсов.

Ключевые компоненты сервера:

    io_context - "сердце" Asio, планировщик операций ввода-вывода.

    tcp::acceptor - принимает входящие соединения.

###### Основной алгоритм сервера:

1. Запустить acceptor в режиме ожидания.
2. При получении нового подключения:
   - Создать новый поток, передав ему сокет.
   - Снова начать ожидание нового подключения.
3. При получении данных в потоке:
   - Прочитать сообщение из буфера.
   - Проверить, существует ли получатель.
   - Если да, поместить сообщение в очередь получателя.
   - Снова начать проверять наличие данных.
4. При отключении клиента подать сигнал для старта нового потока и удалить старый.

Протокол: Было решено, что каждое сообщение будет конвертироваться в json строку, заканчивающуся '\0' . Сервер читает данные до этого разделителя.

##### 2.4. Организация сетевого взаимодействия и протокола обмена

Был разработан простой текстовый протокол поверх TCP.

Формат сообщений:

    Все сообщения - json-строки, у которых значения text предварительно закодированы в base64. 

    Разделитель сообщений - нулевой байт, '\0'.

    Типы сообщений определяются значением json строки type.

Пример сценария:

    Клиент 1 подключается, отправляет { "from": "Андрей", "to": "Даня", "type": "MESSAGE", "text": "Го прогуляем литературу"}

    Сервер помещает сообщение в очередь юзера "Даня" это сообщение.

    Клиент 2 подключается, логинится, после чего сервер отправляет ему сообщение из очереди. 

##### 2.5. Сборка проекта с помощью CMake и тестирование

Структура проекта:
text

flow/
├── server/
│   ├── CMakeLists.txt
│   ├── src/...
│   └── build/...
├── client/
│   ├── CMakeLists.txt
│   ├── src/...
│   ├── qml/...
│   └── build/...
└── README.md               

###### Ключевые моменты в CMakeLists.txt:

    Настройка стандарта C++.

    Поиск пакетов Qt6 и Boost с помощью find_package().

    Подключение необходимых модулей Qt (Core, Quick).

    Сборка двух исполняемых файлов: appserver и appclient.

###### Тестирование:

    Локальное тестирование (на одном компьютере).

        Запуск сервера в терминале.

        Запуск 2 экземпляров клиента.

        Проверка подключения, обмена сообщениями, входа и регистрации.

        Проверка обработки отключений.

#### 3. Заключение

В ходе работы над проектом "Разработка Desktop мессенджера на C++" было решено большинство задач.

    Достигнутая цель: Разработано функциональное клиент-серверное приложение для обмена текстовыми сообщениями в локальной сети.

    Подтверждение гипотезы: Гипотеза подтвердилась. Используя мощные, но доступные для изучения библиотеки (Qt и Boost.Asio), удалось создать сложное сетевое приложение, пройдя полный цикл разработки.

    Образовательные результаты:

        Углубились знания C++: работа с классами, указателями, стандартной библиотекой (контейнеры, потоки).

        Освоены основы сетевого программирования: понятия TCP, сокета, IP-адреса, порта, клиент-серверной архитектуры.

        Получен практический опыт работы с внешними библиотеками: интеграция Qt и Boost в проект, работа с CMake.

        Развиты навыки отладки и решения проблем: поиск и исправление ошибок в многопоточном и сетевом коде требует особого внимания.

    Трудности и их преодоление:

        Синхронизация потоков (GUI и сетевого): Изначально возникали ошибки при попытке обновить интерфейс из сетевого потока. Решено с помощью механизма сигналов и слотов Qt, который безопасно передает данные между потоками.

        Сборка Boost.Asio: Потребовалось время, чтобы правильно настроить CMake для линковки с Boost. Решено изучением документации и примеров.

        Проектирование протокола: Осознание того, что нужен четкий формат для区分 служебных сообщений от обычных. Решено введением простых текстовых меток ([TAG]).

    Перспективы развития проекта:

        Добавление шифрования сообщений для повышения конфиденциальности.

        Поддержка передачи файлов.

        Создание групп в несколько человек.

        Поддержка звонков и голосовых сообщений.

Вывод: Проект является успешным с образовательной и практической точек зрения. Он не только позволил создать полезную программу, но и стал отличной школой для погружения в мир реальной разработки ПО.
#### 4. Список использованных источников и ресурсовf

    Официальная документация:

        Qt Documentation: https://doc.qt.io/qt-6/, https://metanit.com/cpp/qt/

        Boost.Asio Documentation: https://www.boost.org/doc/libs/release/libs/asio/

        C++ Documentation: https://metanit.com/cpp/tutorial/
